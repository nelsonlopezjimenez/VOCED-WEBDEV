/* Copyright © 2004-2015 Trumba Corporation. All rights reserved. */
SpudConnector.addEventListener("connect",function(){if(typeof initMix!="undefined"){initMix()}});Mixer=Class.create();Mixer.prototype={_log:function(b){try{console.log(b)}catch(a){}},initialize:function(g,e,i){this._mixData=e;this._initialValue=i;mySpud.setProperty("navigateHandler",this._onNavigate.bind(this));var d=0;var c=this;var b=g;var a=0;Trumba.Util.cleanUnicode(e.calendars,["text","displayName"]);e.calendars.each(function(l){l.checked=true;var q,o,m,j,p;var n="mixItem"+d++;m=Builder.node("input",{type:"checkbox",className:"twCalendarListCheckbox",checked:l.checked,id:n,"aria-label":l.text});j=Builder.node("a",{href:"javascript:(function(){})()",className:"twCalendarListName"},[l.text]);var k="";if(a==0){k="twCalendarListNameCellFirst"}var o=Builder.node("tr",[Builder.node("td",{className:"twCalendarListNameCell ebg"+l.colorIndex,id:k},[Builder.node("table",{width:"100%",cellspacing:0,cellpadding:0,border:0,className:""},[Builder.node("tbody",[Builder.node("tr",[p=Builder.node("td",[m]),Builder.node("td",{className:"twLabelCell"},[Builder.node("table",{width:"100%",cellspacing:0,cellpadding:0,border:0,className:"twLabelTable"},[Builder.node("tbody",[Builder.node("tr",[Builder.node("td",{className:"twLabelCellInner"},[j])])])])])])])])])]);a=a+1;p.style.paddingLeft=(l.indent*e.pixelsPerIndent)+"px";m._value=l;l.cb=m;l.a=j;c._setCheckState(l,l.checked,false);Event.observe(m,"click",c._onChecked.bind(c,l));Event.observe(j,"click",c._onSelected.bind(c,l));b.appendChild(o)});var h=$("hlAllMix"),f=$("hlNoneMix");h.href=f.href="javascript:(function(){})()";h.setAttribute("aria-label","Select all calendars");f.setAttribute("aria-label","Select no calendars");Event.observe(h,"click",this._selectAllOrNone.bind(this,true),false);Event.observe(f,"click",this._selectAllOrNone.bind(this,false),false);this._setInitialState()},_setCheckState:function(a,c,b){a.checked=c;if(a.cb&&b){a.cb.checked=c}a.a.title=Trumba.String.format("Include only events from {0}",a.displayName);a.a.setAttribute("aria-label",a.a.title)},_onChecked:function(a){this._setCheckState(a,!a.checked,false);if(this._mixData.autoSelectChildren){var c=99;var b=false;this._mixData.calendars.each(function(d){if(d.calendarID==a.calendarID||d.indent>c){if(d.calendarID==a.calendarID){c=d.indent;b=d.checked}d.checked=b;d.cb.checked=b}else{c=99}})}this._navigate()},_onSelected:function(a){var b=99;var c=this._mixData.autoSelectChildren;this._mixData.calendars.each(function(d){if(d.calendarID==a.calendarID||d.indent>b){if(c&&d.calendarID==a.calendarID){b=d.indent}d.checked=true;d.cb.checked=true}else{b=99;d.checked=false;d.cb.checked=false}});this._navigate()},_selectAllOrNone:function(b){var a=0;this._mixData.calendars.each(function(c){a+=c.checked?1:0;c.checked=b;c.cb.checked=b});if(b&&(a==this._mixData.calendars.length)){return}else{if(!b&&a==0){return}}this._navigate()},_setInitialState:function(){this._onNavigate(new TQueryString(this._initialValue?this._initialValue:mySpud.getQueryString()))},_onNavigate:function(a,d){if(d){return true}var c=[],b=[];if(a){c=a.getAt("mixin");c=c?c[1]:"";c=(c==""?[]:c.split(","));b=a.getAt("mixout");b=b?b[1]:"";b=(b==""?[]:b.split(","))}this._updating=true;var e=this;this._mixData.calendars.each(function(f){var g=true;if(c.length==0||c[0]=="-1"){g=true}else{g=(c.indexOf(f.calendarID.toString())!=-1)}if(b.length==0){g=g}else{if(b[0]=="0"){g=true}else{if(b[0]=="-1"){g=false}else{g=!(b.indexOf(f.calendarID.toString())!=-1)}}}if(f.checked!=g){e._setCheckState(f,g,true)}});this._updating=false;return true},_navigate:function(){if(this._updating){return}var b="";var d="";var c=[];var a=[];var e=true;var f=true;this._mixData.calendars.each(function(g){e=e&&g.checked;f=f&&!g.checked;if(g.checked){c.push(g.calendarID)}else{a.push(g.calendarID)}});if(e||f){b=e?"mixin":"mixout";d="-1"}else{if(c.length<a.length){b="mixin";d=c.join(",")}else{b="mixout";d=a.join(",")}}filterNavigate(b,d)}};